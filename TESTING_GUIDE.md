# YouTube IFrame API 재생 흐름 테스트 가이드

## 🚀 테스트 실행 방법

### 1. 개발 서버 실행 확인
```bash
# 터미널에서 확인
netstat -an | findstr :3000
# 결과: TCP    0.0.0.0:3000           0.0.0.0:0            LISTENING
```

### 2. 브라우저에서 테스트 실행

#### A. 기본 테스트 (수동)
1. **브라우저 열기**: http://localhost:3000
2. **로그인**: 테스트 계정으로 로그인
3. **검색**: "음악" 또는 "노래" 검색
4. **영상 선택**: 검색 결과에서 영상 클릭
5. **재생 확인**: 자동 재생 시작 확인

#### B. 자동화 테스트 (콘솔)
1. **개발자 도구 열기**: F12
2. **콘솔 탭 선택**
3. **테스트 스크립트 복사**: `test-playback-automation.js` 내용 복사
4. **실행**: 콘솔에 붙여넣기 후 Enter

### 3. 테스트 시나리오별 확인 사항

#### ✅ 1. YouTube IFrame API 로드 테스트
- **확인 방법**: 콘솔에서 `window.YT` 객체 존재 확인
- **예상 결과**: `window.YT.Player` 함수 사용 가능
- **성공 기준**: API 로드 완료 메시지 출력

#### ✅ 2. 플레이어 초기화 테스트
- **확인 방법**: 영상 선택 후 iframe 요소 생성 확인
- **예상 결과**: YouTube iframe이 정상적으로 로드됨
- **성공 기준**: 영상이 자동으로 재생 시작

#### ✅ 3. 단일 재생 테스트
- **확인 방법**: 재생/일시정지 버튼 클릭
- **예상 결과**: 재생 상태가 정상적으로 토글됨
- **성공 기준**: 시간 표시가 정상적으로 업데이트됨

#### ✅ 4. 연속재생 테스트
- **확인 방법**: 찜 목록에서 여러 곡 선택
- **예상 결과**: 첫 곡 종료 시 자동으로 다음 곡 재생
- **성공 기준**: 플레이리스트 순서대로 재생됨

#### ✅ 5. 반복재생 테스트
- **확인 방법**: 반복 모드 토글 후 단일 곡 재생
- **예상 결과**: 곡 종료 시 같은 곡 자동 재시작
- **성공 기준**: 무한 반복 재생됨

#### ✅ 6. 윈도우 최소화 테스트
- **확인 방법**: 재생 중 윈도우 최소화 후 복원
- **예상 결과**: 재생이 계속됨 (30분 자동 정지 없음)
- **성공 기준**: 30분 후에도 재생 지속

#### ✅ 7. 장시간 재생 테스트
- **확인 방법**: 30분 이상 영상 재생
- **예상 결과**: 시뮬레이션 타이머로 인한 자동 정지 없음
- **성공 기준**: 실제 YouTube 플레이어 상태 기반 동작

#### ✅ 8. 모바일 백그라운드 테스트
- **확인 방법**: Android Chrome에서 앱 백그라운드 전환
- **예상 결과**: 백그라운드에서도 재생 지속
- **성공 기준**: 앱 복원 시 재생 상태 유지

## 🔍 문제 해결

### YouTube IFrame API 로드 실패
```javascript
// 콘솔에서 확인
console.log('YT 객체:', window.YT);
console.log('YT.Player:', window.YT?.Player);
```

### 플레이어 초기화 실패
```javascript
// iframe 요소 확인
const iframe = document.querySelector('iframe[src*="youtube.com"]');
console.log('iframe:', iframe);
console.log('iframe src:', iframe?.src);
```

### 이벤트 수신 실패
```javascript
// 이벤트 리스너 확인
const player = document.querySelector('.video-container');
console.log('player container:', player);
```

## 📊 테스트 결과 기록

### 테스트 환경
- **OS**: Windows 11
- **브라우저**: Chrome/Edge
- **모바일**: Android Chrome
- **테스트 날짜**: ___________

### 테스트 결과
- [ ] YouTube IFrame API 로드
- [ ] 플레이어 초기화
- [ ] 단일 재생
- [ ] 연속재생
- [ ] 반복재생
- [ ] 윈도우 최소화
- [ ] 장시간 재생
- [ ] 모바일 백그라운드

### 성공률: ___/8 (___%)

### 발견된 문제
1. ________________
2. ________________
3. ________________

### 해결 방안
1. ________________
2. ________________
3. ________________

## 🎯 핵심 확인 사항

1. **30분 자동 정지 해결**: 시뮬레이션 타이머 제거로 해결됨
2. **연속재생 정상 동작**: IFrame API의 정확한 ENDED 이벤트 수신
3. **반복재생 정상 동작**: 이벤트 기반으로 안정적 동작
4. **백그라운드 재생 지속**: visibility 의존성 제거로 해결됨
5. **실제 YouTube 상태 동기화**: 1초 폴링으로 정확한 상태 반영
